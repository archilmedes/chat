<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#375EAB">

  <title>httptrace - The Go Programming Language</title>

<link type="text/css" rel="stylesheet" href="../../../../lib/godoc/style.css">

<link rel="stylesheet" href="../../../../lib/godoc/jquery.treeview.css">
<script type="text/javascript">window.initFuncs = [];</script>
</head>
<body>

<div id='lowframe' style="position: fixed; bottom: 0; left: 0; height: 0; width: 100%; border-top: thin solid grey; background-color: white; overflow: auto;">
...
</div><!-- #lowframe -->

<div id="topbar" class="wide"><div class="container">
<div class="top-heading" id="heading-wide"><a href="http://localhost:6060/">The Go Programming Language</a></div>
<div class="top-heading" id="heading-narrow"><a href="http://localhost:6060/">Go</a></div>
<a href="index.html#" id="menu-button"><span id="menu-button-arrow">&#9661;</span></a>
<form method="GET" action="http://localhost:6060/search">
<div id="menu">
<a href="http://localhost:6060/doc/">Documents</a>
<a href="http://localhost:6060/pkg/">Packages</a>
<a href="http://localhost:6060/project/">The Project</a>
<a href="http://localhost:6060/help/">Help</a>

<a href="http://localhost:6060/blog/">Blog</a>


<span class="search-box"><input type="search" id="search" name="q" placeholder="Search" aria-label="Search" required><button type="submit"><span><!-- magnifying glass: --><svg width="24" height="24" viewBox="0 0 24 24"><title>submit search</title><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/><path d="M0 0h24v24H0z" fill="none"/></svg></span></button></span>
</div>
</form>

</div></div>



<div id="page" class="wide">
<div class="container">


  <h1>
    Package httptrace
    <span class="text-muted"></span>
  </h1>







<div id="nav"></div>


<!--
	Copyright 2009 The Go Authors. All rights reserved.
	Use of this source code is governed by a BSD-style
	license that can be found in the LICENSE file.
-->
<!--
	Note: Static (i.e., not template-generated) href and id
	attributes start with "pkg-" to make it impossible for
	them to conflict with generated attributes (some of which
	correspond to Go identifiers).
-->

	<script type='text/javascript'>
	document.ANALYSIS_DATA = null;
	document.CALLGRAPH = null;
	</script>

	
		
		<div id="short-nav">
			<dl>
			<dd><code>import "net/http/httptrace"</code></dd>
			</dl>
			<dl>
			<dd><a href="index.html#pkg-overview" class="overviewLink">Overview</a></dd>
			<dd><a href="index.html#pkg-index" class="indexLink">Index</a></dd>
			
				<dd><a href="index.html#pkg-examples" class="examplesLink">Examples</a></dd>
			
			
			</dl>
		</div>
		<!-- The package's Name is printed as title by the top-level template -->
		<div id="pkg-overview" class="toggleVisible">
			<div class="collapsed">
				<h2 class="toggleButton" title="Click to show Overview section">Overview ▹</h2>
			</div>
			<div class="expanded">
				<h2 class="toggleButton" title="Click to hide Overview section">Overview ▾</h2>
				<p>
Package httptrace provides mechanisms to trace the events within
HTTP client requests.
</p>

			</div>
		</div>
		<div id="example_" class="toggle">
	<div class="collapsed">
		<p class="exampleHeading toggleButton">▹ <span class="text">Example</span></p>
	</div>
	<div class="expanded">
		<p class="exampleHeading toggleButton">▾ <span class="text">Example</span></p>
		
		
		
			<p>Code:</p>
			<pre class="code">
req, _ := http.NewRequest(&#34;GET&#34;, &#34;http://example.com&#34;, nil)
trace := &amp;httptrace.ClientTrace{
    GotConn: func(connInfo httptrace.GotConnInfo) {
        fmt.Printf(&#34;Got Conn: %+v\n&#34;, connInfo)
    },
    DNSDone: func(dnsInfo httptrace.DNSDoneInfo) {
        fmt.Printf(&#34;DNS Info: %+v\n&#34;, dnsInfo)
    },
}
req = req.WithContext(httptrace.WithClientTrace(req.Context(), trace))
_, err := http.DefaultTransport.RoundTrip(req)
if err != nil {
    log.Fatal(err)
}
</pre>
			
		
	</div>
</div>


		<div id="pkg-index" class="toggleVisible">
		<div class="collapsed">
			<h2 class="toggleButton" title="Click to show Index section">Index ▹</h2>
		</div>
		<div class="expanded">
			<h2 class="toggleButton" title="Click to hide Index section">Index ▾</h2>

		<!-- Table of contents for API; must be named manual-nav to turn off auto nav. -->
			<div id="manual-nav">
			<dl>
			
			
			
				
				<dd><a href="index.html#WithClientTrace">func WithClientTrace(ctx context.Context, trace *ClientTrace) context.Context</a></dd>
			
			
				
				<dd><a href="index.html#ClientTrace">type ClientTrace</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#ContextClientTrace">func ContextClientTrace(ctx context.Context) *ClientTrace</a></dd>
				
				
			
				
				<dd><a href="index.html#DNSDoneInfo">type DNSDoneInfo</a></dd>
				
				
			
				
				<dd><a href="index.html#DNSStartInfo">type DNSStartInfo</a></dd>
				
				
			
				
				<dd><a href="index.html#GotConnInfo">type GotConnInfo</a></dd>
				
				
			
				
				<dd><a href="index.html#WroteRequestInfo">type WroteRequestInfo</a></dd>
				
				
			
			
			</dl>
			</div><!-- #manual-nav -->

		
		<div id="pkg-examples">
			<h3>Examples</h3>
			<dl>
			
			<dd><a class="exampleLink" href="index.html#example_">Package</a></dd>
			
			</dl>
		</div>
		

		
			<h3>Package files</h3>
			<p>
			<span style="font-size:90%">
			
				<a href="http://localhost:6060/src/net/http/httptrace/trace.go">trace.go</a>
			
			</span>
			</p>
		
		</div><!-- .expanded -->
		</div><!-- #pkg-index -->

		<div id="pkg-callgraph" class="toggle" style="display: none">
		<div class="collapsed">
			<h2 class="toggleButton" title="Click to show Internal Call Graph section">Internal call graph ▹</h2>
		</div> <!-- .expanded -->
		<div class="expanded">
			<h2 class="toggleButton" title="Click to hide Internal Call Graph section">Internal call graph ▾</h2>
			<p>
			  In the call graph viewer below, each node
			  is a function belonging to this package
			  and its children are the functions it
			  calls&mdash;perhaps dynamically.
			</p>
			<p>
			  The root nodes are the entry points of the
			  package: functions that may be called from
			  outside the package.
			  There may be non-exported or anonymous
			  functions among them if they are called
			  dynamically from another package.
			</p>
			<p>
			  Click a node to visit that function's source code.
			  From there you can visit its callers by
			  clicking its declaring <code>func</code>
			  token.
			</p>
			<p>
			  Functions may be omitted if they were
			  determined to be unreachable in the
			  particular programs or tests that were
			  analyzed.
			</p>
			<!-- Zero means show all package entry points. -->
			<ul style="margin-left: 0.5in" id="callgraph-0" class="treeview"></ul>
		</div>
		</div> <!-- #pkg-callgraph -->

		
		
		
			
			
			<h2 id="WithClientTrace">func <a href="http://localhost:6060/src/net/http/httptrace/trace.go?s=974:1051#L23">WithClientTrace</a>
				<a class="permalink" href="index.html#WithClientTrace">&#xb6;</a>
			</h2>
			<pre>func WithClientTrace(ctx <a href="../../../context/index.html">context</a>.<a href="../../../context/index.html#Context">Context</a>, trace *<a href="index.html#ClientTrace">ClientTrace</a>) <a href="../../../context/index.html">context</a>.<a href="../../../context/index.html#Context">Context</a></pre>
			<p>
WithClientTrace returns a new context based on the provided parent
ctx. HTTP client requests made with the returned context will use
the provided trace hooks, in addition to any previous hooks
registered with ctx. Any hooks defined in the provided trace will
be called first.
</p>

			
			

		
		
			
			
			<h2 id="ClientTrace">type <a href="http://localhost:6060/src/net/http/httptrace/trace.go?s=2342:5203#L69">ClientTrace</a>
				<a class="permalink" href="index.html#ClientTrace">&#xb6;</a>
			</h2>
			<p>
ClientTrace is a set of hooks to run at various stages of an outgoing
HTTP request. Any particular hook may be nil. Functions may be
called concurrently from different goroutines and some may be called
after the request has completed or failed.
</p>
<p>
ClientTrace currently traces a single HTTP request &amp; response
during a single round trip and has no hooks that span a series
of redirected requests.
</p>
<p>
See <a href="https://blog.golang.org/http-tracing">https://blog.golang.org/http-tracing</a> for more.
</p>

			<pre>type ClientTrace struct {
<span id="ClientTrace.GetConn"></span>    <span class="comment">// GetConn is called before a connection is created or</span>
    <span class="comment">// retrieved from an idle pool. The hostPort is the</span>
    <span class="comment">// &#34;host:port&#34; of the target or proxy. GetConn is called even</span>
    <span class="comment">// if there&#39;s already an idle cached connection available.</span>
    GetConn func(hostPort <a href="../../../builtin/index.html#string">string</a>)

<span id="ClientTrace.GotConn"></span>    <span class="comment">// GotConn is called after a successful connection is</span>
    <span class="comment">// obtained. There is no hook for failure to obtain a</span>
    <span class="comment">// connection; instead, use the error from</span>
    <span class="comment">// Transport.RoundTrip.</span>
    GotConn func(<a href="index.html#GotConnInfo">GotConnInfo</a>)

<span id="ClientTrace.PutIdleConn"></span>    <span class="comment">// PutIdleConn is called when the connection is returned to</span>
    <span class="comment">// the idle pool. If err is nil, the connection was</span>
    <span class="comment">// successfully returned to the idle pool. If err is non-nil,</span>
    <span class="comment">// it describes why not. PutIdleConn is not called if</span>
    <span class="comment">// connection reuse is disabled via Transport.DisableKeepAlives.</span>
    <span class="comment">// PutIdleConn is called before the caller&#39;s Response.Body.Close</span>
    <span class="comment">// call returns.</span>
    <span class="comment">// For HTTP/2, this hook is not currently used.</span>
    PutIdleConn func(err <a href="../../../builtin/index.html#error">error</a>)

<span id="ClientTrace.GotFirstResponseByte"></span>    <span class="comment">// GotFirstResponseByte is called when the first byte of the response</span>
    <span class="comment">// headers is available.</span>
    GotFirstResponseByte func()

<span id="ClientTrace.Got100Continue"></span>    <span class="comment">// Got100Continue is called if the server replies with a &#34;100</span>
    <span class="comment">// Continue&#34; response.</span>
    Got100Continue func()

<span id="ClientTrace.DNSStart"></span>    <span class="comment">// DNSStart is called when a DNS lookup begins.</span>
    DNSStart func(<a href="index.html#DNSStartInfo">DNSStartInfo</a>)

<span id="ClientTrace.DNSDone"></span>    <span class="comment">// DNSDone is called when a DNS lookup ends.</span>
    DNSDone func(<a href="index.html#DNSDoneInfo">DNSDoneInfo</a>)

<span id="ClientTrace.ConnectStart"></span>    <span class="comment">// ConnectStart is called when a new connection&#39;s Dial begins.</span>
    <span class="comment">// If net.Dialer.DualStack (IPv6 &#34;Happy Eyeballs&#34;) support is</span>
    <span class="comment">// enabled, this may be called multiple times.</span>
    ConnectStart func(network, addr <a href="../../../builtin/index.html#string">string</a>)

<span id="ClientTrace.ConnectDone"></span>    <span class="comment">// ConnectDone is called when a new connection&#39;s Dial</span>
    <span class="comment">// completes. The provided err indicates whether the</span>
    <span class="comment">// connection completedly successfully.</span>
    <span class="comment">// If net.Dialer.DualStack (&#34;Happy Eyeballs&#34;) support is</span>
    <span class="comment">// enabled, this may be called multiple times.</span>
    ConnectDone func(network, addr <a href="../../../builtin/index.html#string">string</a>, err <a href="../../../builtin/index.html#error">error</a>)

<span id="ClientTrace.TLSHandshakeStart"></span>    <span class="comment">// TLSHandshakeStart is called when the TLS handshake is started. When</span>
    <span class="comment">// connecting to a HTTPS site via a HTTP proxy, the handshake happens after</span>
    <span class="comment">// the CONNECT request is processed by the proxy.</span>
    TLSHandshakeStart func()

<span id="ClientTrace.TLSHandshakeDone"></span>    <span class="comment">// TLSHandshakeDone is called after the TLS handshake with either the</span>
    <span class="comment">// successful handshake&#39;s connection state, or a non-nil error on handshake</span>
    <span class="comment">// failure.</span>
    TLSHandshakeDone func(<a href="../../../crypto/tls/index.html">tls</a>.<a href="../../../crypto/tls/index.html#ConnectionState">ConnectionState</a>, <a href="../../../builtin/index.html#error">error</a>)

<span id="ClientTrace.WroteHeaders"></span>    <span class="comment">// WroteHeaders is called after the Transport has written</span>
    <span class="comment">// the request headers.</span>
    WroteHeaders func()

<span id="ClientTrace.Wait100Continue"></span>    <span class="comment">// Wait100Continue is called if the Request specified</span>
    <span class="comment">// &#34;Expected: 100-continue&#34; and the Transport has written the</span>
    <span class="comment">// request headers but is waiting for &#34;100 Continue&#34; from the</span>
    <span class="comment">// server before writing the request body.</span>
    Wait100Continue func()

<span id="ClientTrace.WroteRequest"></span>    <span class="comment">// WroteRequest is called with the result of writing the</span>
    <span class="comment">// request and any body. It may be called multiple times</span>
    <span class="comment">// in the case of retried requests.</span>
    WroteRequest func(<a href="index.html#WroteRequestInfo">WroteRequestInfo</a>)
}</pre>

			

			

			
			
			

			
				
				<h3 id="ContextClientTrace">func <a href="http://localhost:6060/src/net/http/httptrace/trace.go?s=543:600#L13">ContextClientTrace</a>
					<a class="permalink" href="index.html#ContextClientTrace">&#xb6;</a>
				</h3>
				<pre>func ContextClientTrace(ctx <a href="../../../context/index.html">context</a>.<a href="../../../context/index.html#Context">Context</a>) *<a href="index.html#ClientTrace">ClientTrace</a></pre>
				<p>
ContextClientTrace returns the ClientTrace associated with the
provided context. If none, it returns nil.
</p>

				
				
			

			
		
			
			
			<h2 id="DNSDoneInfo">type <a href="http://localhost:6060/src/net/http/httptrace/trace.go?s=6500:6876#L194">DNSDoneInfo</a>
				<a class="permalink" href="index.html#DNSDoneInfo">&#xb6;</a>
			</h2>
			<p>
DNSDoneInfo contains information about the results of a DNS lookup.
</p>

			<pre>type DNSDoneInfo struct {
<span id="DNSDoneInfo.Addrs"></span>    <span class="comment">// Addrs are the IPv4 and/or IPv6 addresses found in the DNS</span>
    <span class="comment">// lookup. The contents of the slice should not be mutated.</span>
    Addrs []<a href="../../index.html">net</a>.<a href="../../index.html#IPAddr">IPAddr</a>

<span id="DNSDoneInfo.Err"></span>    <span class="comment">// Err is any error that occurred during the DNS lookup.</span>
    Err <a href="../../../builtin/index.html#error">error</a>

<span id="DNSDoneInfo.Coalesced"></span>    <span class="comment">// Coalesced is whether the Addrs were shared with another</span>
    <span class="comment">// caller who was doing the same DNS lookup concurrently.</span>
    Coalesced <a href="../../../builtin/index.html#bool">bool</a>
}</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="DNSStartInfo">type <a href="http://localhost:6060/src/net/http/httptrace/trace.go?s=6386:6427#L189">DNSStartInfo</a>
				<a class="permalink" href="index.html#DNSStartInfo">&#xb6;</a>
			</h2>
			<p>
DNSStartInfo contains information about a DNS request.
</p>

			<pre>type DNSStartInfo struct {
<span id="DNSStartInfo.Host"></span>    Host <a href="../../../builtin/index.html#string">string</a>
}</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="GotConnInfo">type <a href="http://localhost:6060/src/net/http/httptrace/trace.go?s=7178:7687#L216">GotConnInfo</a>
				<a class="permalink" href="index.html#GotConnInfo">&#xb6;</a>
			</h2>
			<p>
GotConnInfo is the argument to the ClientTrace.GotConn function and
contains information about the obtained connection.
</p>

			<pre>type GotConnInfo struct {
<span id="GotConnInfo.Conn"></span>    <span class="comment">// Conn is the connection that was obtained. It is owned by</span>
    <span class="comment">// the http.Transport and should not be read, written or</span>
    <span class="comment">// closed by users of ClientTrace.</span>
    Conn <a href="../../index.html">net</a>.<a href="../../index.html#Conn">Conn</a>

<span id="GotConnInfo.Reused"></span>    <span class="comment">// Reused is whether this connection has been previously</span>
    <span class="comment">// used for another HTTP request.</span>
    Reused <a href="../../../builtin/index.html#bool">bool</a>

<span id="GotConnInfo.WasIdle"></span>    <span class="comment">// WasIdle is whether this connection was obtained from an</span>
    <span class="comment">// idle pool.</span>
    WasIdle <a href="../../../builtin/index.html#bool">bool</a>

<span id="GotConnInfo.IdleTime"></span>    <span class="comment">// IdleTime reports how long the connection was previously</span>
    <span class="comment">// idle, if WasIdle is true.</span>
    IdleTime <a href="../../../time/index.html">time</a>.<a href="../../../time/index.html#Duration">Duration</a>
}</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="WroteRequestInfo">type <a href="http://localhost:6060/src/net/http/httptrace/trace.go?s=5284:5387#L146">WroteRequestInfo</a>
				<a class="permalink" href="index.html#WroteRequestInfo">&#xb6;</a>
			</h2>
			<p>
WroteRequestInfo contains information provided to the WroteRequest
hook.
</p>

			<pre>type WroteRequestInfo struct {
<span id="WroteRequestInfo.Err"></span>    <span class="comment">// Err is any error encountered while writing the Request.</span>
    Err <a href="../../../builtin/index.html#error">error</a>
}</pre>

			

			

			
			
			

			

			
		
	

	







<div id="footer">
Build version go1.10.<br>
Except as <a href="https://developers.google.com/site-policies#restrictions">noted</a>,
the content of this page is licensed under the
Creative Commons Attribution 3.0 License,
and code is licensed under a <a href="http://localhost:6060/LICENSE">BSD license</a>.<br>
<a href="http://localhost:6060/doc/tos.html">Terms of Service</a> |
<a href="http://www.google.com/intl/en/policies/privacy/">Privacy Policy</a>
</div>

</div><!-- .container -->
</div><!-- #page -->

<!-- TODO(adonovan): load these from <head> using "defer" attribute? -->
<script type="text/javascript" src="../../../../lib/godoc/jquery.js"></script>
<script type="text/javascript" src="../../../../lib/godoc/jquery.treeview.js"></script>
<script type="text/javascript" src="../../../../lib/godoc/jquery.treeview.edit.js"></script>


<script>var goVersion = "go1.10";</script>
<script type="text/javascript" src="../../../../lib/godoc/godocs.js"></script>

</body>
</html>

